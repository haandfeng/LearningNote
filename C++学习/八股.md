# Select,  Poll, Epoll的区别
select、poll、epoll都是I/0多路复用技术，使得程序能够监听多个文件描述符，能提高程序的性能
## Select
1. ﻿﻿首先往用户区构造一个关于文件描述符的列表，将要监听的文件描述符添加到该列表中，
2. ﻿﻿通过select（）函数监听列表中的文件描述符，直到这些描述符中的一个或者多个进行I/0操作时，该函数才返回。 
	1. ﻿﻿这个函数是阻塞
	2. ﻿﻿函数对文件描述符的检测的操作是由*内核**完成的（涉及到一个将列表从用户条拷贝到内核态的操作）

3. 返多少的文件描述符需要进行I/0操作把内核态的文件描述符列表拷贝到用户
4. 主进程遍历文件描述符列表，处理I/0事件

缺点：

1. ﻿﻿每次调用select，都需要把fd集合从用户态拷贝到内核态，再有内核态拷贝到用户态，这个开销在fd很多时会很大
2. ﻿﻿同时每次调用select都需要在内核遍历传递进来的所有fd，再拷贝出来还需要遍历所有pd，这个开销在fd很多时也很大
3. ﻿﻿﻿select支持的文件描述符数量太小了，默认是1024
4. ﻿﻿文件描述符列表不能重用，每次都需要重置

## Poll
相比slect，poll将存储文件描述符的列表换成了动态数组，以链表形式来组织，突破了文件描述符数量的限制。其他的与select一样吧

poll 不再用 BitsMap 来存储所关注的文件描述符，取而代之用动态数组，以链表形式来组织，突破了 select 的文件描述符个数限制，当然还会受到系统文件描述符限制。

但是 poll 和 select 并没有太大的本质区别，都是使用「线性结构」存储进程关注的 Socket集合，因此都需要遍历文件描述符集合来找到可读或可写的 Socket，时间复杂度为 O（n），而且也需要在用户态与内核态之间拷贝文件描述符集合，这种方式随着并发数上来，性能的损耗会呈撸数级增长

## Epoll
1. epoll直接在内核中创建两个数据结构，一个是用来存储待监测文件描述符的红黑树，一个是存储发生I/0事件的就绪列表（双链表）。
2. 通过epoll_ wait（）函数遍历存放所有fd的红黑树，并将发生事件对应的文件描述符fd直接插入到就绪列表中。
3. 主进程直接遍历内核返回的就绪列表，处理I/0事件
epoll有两种事件处方方式：水平触发LT与边沿触发ET
### LT
假设委托内核检测读事件 -> 检测fd的读缓冲区
读缓冲区有数据-＞epoll检测到了会给用户通知
a.用户不读数据，数据一直在缓冲区，epoll会一直通知
b.用户只读了一部分数据，epoll会通知
c.缓冲区的数据读完了，不通知

LT（level - triggered）是缺省的工作方式，并且同时支持block 和 no-block socket。在这种做法中，内核告诉你一个文件描述符是否就绪了，然后你可以对这个就绪的fd 进行IO操作。如果你不作任何操作，内核还是会继续通知你的。
### ET
假设委托内核检测读事件->检测fd的读缓冲区
读缓冲区有数据->epoll检测到了会给用户通知
a.用户不读数据，数据一致在缓冲区中，epoll下次检测的时候就不通知了
b.用户只读了一部分数据，epoll不通知
c.缓冲区的数据读完了，不通知

ET（edge - triggered）是高速工作方式，只支持 no-block socket。在这种模式下，当描述符从未就绪变为就绪时，内核通过epoll告诉你。然后它会假设你知道文件描述符已经就绪，并且不会再为那个文件描述符发送更多的就绪通知，直到你做了某些操作导致那个文件描述符不再为就绪状态了。但是请注意，如果一直不对这个 fd 作IO操作（从而导致它再次变成未就绪）。内核不会发送更多的通知（only once)

ET 模式在很大程度上减少了 epoll 事件被重复触发的次数，因此效率要比LT 模式高。epoll
工作在 ET 模式的时候，必须使用非阻塞套接口，以避免由于一个文件句柄的阻塞读/阻塞写操作把处理多个文件描述符的任务饿死

# 智能指针
[参考链接](https://blog.csdn.net/cpp_learner/article/details/118912592)


# Linux 常用指令
[Linux使用详解](https://mp.weixin.qq.com/s/pgPCgnv3VrzpUtauz0okSg)
## 查看系统资源
1. top命令：这是一个实时显示系统中各个进程的资源占用状况的监视器。它可以展示CPU使用率、内存使用率、进程状态等信息。通过top命令，用户可以快速识别哪些进程占用了过多的系统资源。
2. ps命令：用于显示当前系统中活动进程的信息。通过执行“ps -ef”或“ps aux”，用户可以查看所有进程的详细信息，包括进程ID、CPU和内存使用率等。此外，结合grep命令，可以方便地查找特定进程。
3. free命令：用于显示系统的内存使用情况。执行“free -m”可以以MB为单位显示内存使用情况，包括总内存、已用内存、空闲内存等信息。
4. df命令：用于显示磁盘分区上的可用和已使用的磁盘空间。执行“df -h”可以以人类可读的格式（如GB、MB）显示磁盘空间使用情况。
5. sar命令：这是一个系统活动报告工具，可以用于收集、报告和保存系统活动信息。通过sar命令，用户可以查看CPU使用率、内存使用率、I/O等历史数据。
6. vmstat命令：用于显示关于系统虚拟内存、进程、CPU活动等的统计信息。通过vmstat命令，用户可以实时监控系统的资源使用情况。

## 查看日志
1. tail命令：常用于查看实时变化的日志文件。例如，“tail -f /var/log/syslog”可以实时查看系统日志的最新内容。此外，“tail -n [行数] 文件名”可用于查看文件的最后几行。
2. cat命令：用于显示文件内容。结合grep命令，可以搜索关键字附近的日志内容。例如，“cat /var/log/syslog | grep '关键字'”可以搜索包含特定关键字的日志行。
3. less命令：这是一个强大的文本查看器，允许用户向前和向后翻页查看文件内容。对于大型日志文件，less命令提供了方便的导航和搜索功能。
4. head命令：与tail命令相反，head命令用于查看文件的开头部分。例如，“head -n [行数] 文件名”可以查看文件的前几行。
5. more命令：以全屏幕的方式按页显示文件内容，适合查看长文件。
## 查看网络状态
1. ifconfig：此命令用于显示和配置网络接口的详细信息，包括IP地址、MAC地址、网络掩码等。例如，ifconfig 可以列出所有活动网卡的信息。
2. ip：ip 命令是一个多功能的网络工具，用于显示或操作路由、网络设备、策略路由和隧道。例如，ip addr 可以显示网络接口的详细信息，类似于 ifconfig；ip route 可以显示路由表信息。
3. netstat： 此命令用于显示网络连接、路由表、接口统计等网络相关信息。例如，netstat -an 可以显示所有活动的网络连接和监听的端口。
4. ss：ss 命令是一个比 netstat 更强大的工具，用于查看系统的socket统计信息。它可以提供更详细的信息，并且比 netstat 更快。例如，ss -tuln 可以列出所有TCP和UDP的监听端口。
5. ping：此命令用于测试网络的连通性，通过发送ICMP回显请求数据包到目标主机，并等待接收回显回复数据包来判断网络是否连通。例如，ping www.baidu.com 可以测试到Baidu的网络连通性。



# MySql慢查询
[优化MySQL慢查询](https://blog.csdn.net/danci_/article/details/139395195)
## 引起慢查询的原因大致归纳

1. 没有索引或索引不生效：
	没有在适当的列上建立索引，导致MySQL执行全表扫描。
	索引设计不合理或查询条件导致索引失效，如隐式类型转换、查询条件包含OR等。
2. I/O吞吐量小：
	磁盘I/O成为瓶颈，导致数据读取速度缓慢。
3. 内存不足：
	MySQL需要频繁地进行磁盘I/O操作以获取数据，降低了查询速度。
4. 网络速度慢：
	对于远程数据库连接，网络延迟可能导致查询响应缓慢。
	查询出的数据量过大：
	查询返回的结果集过大，增加了数据传输和处理的时间。
5. 锁或死锁：
	查询时遇到表锁、行锁或其他类型的锁，导致查询被阻塞或延迟。
6. 查询语句未优化：
	查询语句编写不合理，如使用了不必要的子查询、复杂的连接条件等。
7. 硬件资源限制：
	CPU、内存、磁盘等硬件资源不足或配置不合理，影响MySQL性能。
 
## 解决和避免慢查询\
- 提高网速、更换更高容量的硬盘、增加内存或者 cpu 的数量等等。
- 调整配置参数：mysql 有许多参数可以配置，可以根据实际情况调整这些参数，如增加缓存大小、线程池大小等等。
- 添加索引：索引可以提高查询效率，特别是对于大型表。通过分析慢查询日志或者使用 explain 命令找到需要优化的查询语句，然后为其中涉及的列添加索引（注意不要添加过多的索引）。
- 优化查询语句：合理优化查询语句可以减少查询时间。例如，可以尝试减少子查询的数量，避免使用SELECT *，多表JOIN，避免使用 like ‘%xxx%’ 的模糊查询等。
- 批量处理数据：有时候大量数据的操作往往比单个数据的操作更有效率。因此，尽可能以批量方式操作数据，如使用 insert … values() 和 update … set … where in() 等。
- 分库分表：若数据量较大，可能会对单个数据库的性能造成压力。此时可以考虑将数据分散存储到多个数据库中，或者将单张表的数据拆分为多张表来存储。注意，这种方法需要谨慎设计，在实际应用中可能会引入更多的问题。
- 表中的大字段剥离。
- 字段冗余。
- 减少sql中函数运算与其他计算。
- 修改SQL语句：优化查询语句，避免使用SELECT *、子查询、多表JOIN等不必要的操作。
- 数据库优化：调整数据库参数、内存占用、磁盘IO等，提高系统性能，增加查询效率。
- 针对查询频繁的热点数据增加缓存，引入非关系型数据库。
- 主从复制，读写分离，一般情况下，查询的情况比写的情况多，所以考虑将数据库分为主库，从库，主库处理写的操作，从库处理读的操作


首先，我们需要通过配置MySQL的慢查询日志功能来监控慢查询。这包括临时配置和永久配置两种方式，其中永久配置需要在MySQL的配置文件中设置相关参数，并确保MySQL服务重启后配置生效。