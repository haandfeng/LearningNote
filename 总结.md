## conversion = target(是否购买)
0 不买
1 买

## offer= treatment(优惠政策)
0 没有优惠
-1 bogo优惠
1 discount优惠

## target_class(用户类型)
0  CN 给了优惠才买
1   CR 给不给优惠都买  (treatment =0 无优惠 and target!=0 买)
2   TN 给了优惠也不买 (treatment !=0 有优惠 and target!=0 不买)
3   SleepDog 屁也不是 (treatment !=0 有优惠 and target!=0 买)


## 算法
### 分割数据：
1. 分割训练变量和结果变量DataFrame 
	`df_model` 中分离出特征变量和目标变量。特征变量 `X` 是去除了 'target' 和 'target_class' 列之后的 DataFrame。目标变量 `y` 是 'target_class' 列。
2. 拆分训练集和测试集
   - 接着，使用 `train_test_split` 函数将数据集划分为训练集和测试集。参数 `test_size=0.3` 指定了测试集所占比例为 30%，`random_state=42` 设置了随机种子以确保可重复性，`stratify=df_model['treatment']` 根据 'treatment' 列进行分层抽样，以保证训练集和测试集中的 'treatment' 列的分布比例与原始数据集中的相同。
```python
def uplift_split(df_model:pd.DataFrame):
    ## 1 - Train-Test Split
    X = df_model.drop(['target','target_class'],axis=1)
    y = df_model.target_class
    X_train, X_test, y_train, y_test  = train_test_split(X, y,
                                       test_size=0.3,
                                       random_state=42,
                                       stratify=df_model['treatment'])
    return X_train,X_test, y_train, y_test
```

### 训练模型

```python
def uplift_model(X_train:pd.DataFrame,
                 X_test:pd.DataFrame,
                 y_train:pd.DataFrame,
                 y_test:pd.DataFrame):
    ## 2 - Using XGB to get the uplift score
    # Create new dataframe
    result = pd.DataFrame(X_test).copy()    
    # Fit the model
    uplift_model = xgb.XGBClassifier().fit(X_train.drop('treatment', axis=1), y_train)
        # Predict using test-data
    uplift_proba =  uplift_model.predict_proba(X_test.drop('treatment', axis=1))
    result['proba_CN'] = uplift_proba[:,0] 
    result['proba_CR'] = uplift_proba[:,1] 
    result['proba_TN'] = uplift_proba[:,2] 
    result['proba_TR'] = uplift_proba[:,3]
    result['uplift_score'] = result.eval('\
    proba_CN/(proba_CN+proba_CR) \
    + proba_TR/(proba_TN+proba_TR) \
    - proba_TN/(proba_TN+proba_TR) \
    - proba_CR/(proba_CN+proba_CR)')  
    # Put the result 
    result['target_class'] = y_test
    return result
```